<div class="flex justify-center items-center h-screen">
  <div class="relative">
      <video id="camera-preview" autoplay playsinline class="w-screen h-screen"></video>
      <button id="capture-button" class="absolute bottom-5 left-1/2 transform -translate-x-1/2 bg-yellow-500 h-14 w-14 rounded-full border-4 border-white"></button>
      <button id="toggle-camera-button" class="absolute bottom-5 left-20 transform -translate-x-1/2 bg-yellow-500 h-14 w-14 rounded-full border-4 border-white"></button>
  </div>
</div>








  <script>
let useFrontCamera = true;

async function toggleCamera() {
    useFrontCamera = !useFrontCamera;
    
    try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: useFrontCamera ? "user" : "environment" } });
        const videoElement = document.getElementById("camera-preview");
        videoElement.srcObject = stream;
    } catch (error) {
        console.error("Error accessing camera:", error);
    }
}

async function setupCamera() {
    try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
        const videoElement = document.getElementById("camera-preview");
        videoElement.srcObject = stream;
    } catch (error) {
        console.error("Error accessing camera:", error);
    }
}

const toggleCameraButton = document.getElementById("toggle-camera-button");
    toggleCameraButton.addEventListener("click", toggleCamera);


    setupCamera();

    const captureButton = document.getElementById("capture-button");
    const videoElement = document.getElementById("camera-preview");

    captureButton.addEventListener("click", async () => {
    const canvas = document.createElement("canvas");
    canvas.width = videoElement.videoWidth;
    canvas.height = videoElement.videoHeight;

    const context = canvas.getContext("2d");
    context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);

    // Convert the canvas data to a data URL representing a PNG image
    const imageDataURL = canvas.toDataURL("image/png");

    // Open a new tab with the captured image
    const newTab = window.open();

    newTab.document.write(`<img src="${imageDataURL}" alt="Captured Image" />`);

    (async () => {
                let results = await fetch("/.netlify/functions/upload_posts").then(response => response.json());
                results.forEach(result => {
                    const listItem = document.createElement("li");
                    const listImg = document.createElement("img");
                    listImg.src = result.poster;
                    listItem.innerText = result.title;
                    document.getElementById("movies").appendChild(listItem);
                    document.getElementById("movies").appendChild(listImg);
                });
            })();
});




  </script>